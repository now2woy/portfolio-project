<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jineddy.system.mapper.menu.MenuMapper">

<!-- !!!!! -->
<!-- 1. 건수 조회 -->
<!-- !!!!! -->
<!-- 목록 조회 : 메뉴 -->
	<select id="selectCountAll" parameterType="kr.co.jineddy.system.api.menu.dto.MenuResponseDto" resultType="Long">
		/* system.mapper.menu.MenuMapper.selectCountAll */
		SELECT
			COUNT(*) AS CNT
		FROM sys_menu_mst A
	</select>
	
	
	
<!-- !!!!! -->
<!-- 2. 목록 조회 -->
<!-- !!!!! -->
<!-- 목록 조회 : 메뉴 -->
	<select id="selectPageAll" parameterType="kr.co.jineddy.system.api.menu.dto.MenuResponseDto" resultType="kr.co.jineddy.system.api.menu.dto.MenuResponseDto">
		/* system.mapper.menu.MenuMapper.selectPageAll */
			SELECT
				A.*
			FROM sys_menu_mst A
			WHERE 1 = 1
			ORDER BY sort_ord ASC
			LIMIT #{pageSize}
			OFFSET #{offset}
	</select>
	
<!-- 목록 조회 : 사용자 ID 기준 메뉴 목록 -->
	<select id="selectListByUserId" parameterType="String" resultType="kr.co.jineddy.system.api.menu.dto.MenuResponseDto">
		/* system.mapper.menu.MenuMapper.selectListByUserId */
			WITH RECURSIVE menu_hierarchy AS (
				SELECT
					m.menu_id
					, m.menu_nm
					, m.up_menu_id
					, m.link_url
					, m.icon_cd
					, m.sort_ord
					, m.use_yn
				FROM
					sys_menu_mst m
				INNER JOIN
					sys_auth_menu_map am ON m.menu_id = am.menu_id
				INNER JOIN
					sys_user_auth_map ua ON am.auth_id = ua.auth_id
				WHERE ua.user_id = #{userId}
				AND m.use_yn = 'Y'
				UNION
				SELECT
					pm.menu_id
					, pm.menu_nm
					, pm.up_menu_id
					, pm.link_url
					, pm.icon_cd
					, pm.sort_ord
					, pm.use_yn
				FROM
					sys_menu_mst pm
				INNER JOIN
					menu_hierarchy mh ON pm.menu_id = mh.up_menu_id
				WHERE pm.use_yn = 'Y'
			)
			SELECT DISTINCT
				menu_id
				, menu_nm
				, up_menu_id
				, link_url
				, icon_cd
				, sort_ord
			FROM
				menu_hierarchy
			WHERE up_menu_id IS NOT NULL
			ORDER BY sort_ord ASC
	</select>
	
	
	
<!-- !!!!! -->
<!-- 3. 단건 조회 -->
<!-- !!!!! -->
	
	
	
</mapper>